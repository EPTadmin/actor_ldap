{% extends 'partials/base.html' %}

{%block content%}

<style>
  {
    box-sizing: border-box;
  }
  
  .column {
    float: right;
    width: 45%;
    padding: 30px;
  }
  
  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  </style>

<div class="row">
  <div class="column" >
    <canvas id="myChart"></canvas>
  </div>
  <div class="column">
    <canvas id="myChart2"></canvas>

  </div>
</div>
<div class="row">
  <div class="column" >
    <canvas id="myChart3"></canvas>
  </div>
  <div class="column">
    <canvas id="myChart4"></canvas>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    <script>

      const take = (arr, n = 1) => arr.slice(0, n);
    


      function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
      }

      var personcourses = {{personcourses|safe}}



      var personactivities_position = {{personactivities_position|safe}}
      var personactivities_project = {{personactivities_project|safe}}

 
      
      
      var lineChartData = {
        labels:personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Project  = personactivities_project.filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>personactivities_project['activity_type']).filter(onlyUnique)
      Position  = personactivities_position.filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>personactivities_position['activity_type']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person'])

          let unique_lecturer = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });

          type =personcourses.map((personcourse)=>personcourse['course_type'])
          let unique_type = type.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });
          console.log(unique_type)
          unique_type.push('position','project')
          let text = "["
          let text2 = "]"

          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_position=[]
          var array_new_project=[]

          var array_new_Project=[]

          var array_new_total =[]
          var p=0


          for (k = 0; k <unique_lecturer.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            amount_position = 0
            amount_project = 0

            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  
                  if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }

                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252
 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      //array_indecol_new_FE.push(amount_FE) 

                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }

                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='PH'){
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    if  (poeng){
                      amount_PH += 250
                    }
                  }


                }
               }
               
              }
              if ((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer[k]) || (personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer[k])){
    
                if((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer[k])){
    
                  poeng= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['arsverk'])))
                  amount= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['amount'])))
                  amount_position += 1750*poeng*amount/100
                  
                }
                if((personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer[k])){
                      poeng= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['activity_antall_time'])))
                      amount= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['amount'])))
    
                      amount_project += poeng*amount

                    }

              }

              array_new_O1.push(amount_01) 
              array_new_O2.push(amount_02) 
              array_new_FE.push(amount_FE)
              array_new_FP.push(amount_FP)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_position.push(amount_position)
              array_new_project.push(amount_project)

          } 
   

              array_new_total.push(text.concat([array_new_O1]).concat(text2)) 
              array_new_total.push(text.concat([array_new_O2]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FE]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FP]).concat(text2)) 
              array_new_total.push(text.concat([array_new_MS]).concat(text2)) 
              array_new_total.push(text.concat([array_new_PH]).concat(text2)) 
              array_new_total.push(text.concat([array_new_position]).concat(text2)) 
              array_new_total.push(text.concat([array_new_project]).concat(text2)) 


          array_ses = array
          var color=[]
          color.push("#9ad0f5","#ffb0c1","#f7be85","#ffe6aa","#a4dfdf","#ccb2ff","#6a7e69","#825acf")


    array_new_total.forEach(function (a, i) {
          lineChartData.datasets.push({
              label:  unique_type[i],
              fillColor: 'rgba(216,140,154,0.2)',
              strokeColor: 'rgba(216,140,154,1)',
              pointColor: 'rgba(216,140,154,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(216,140,154,1)',
                  backgroundColor:color[i],
              data: JSON.parse(a)

           }
           )

          ;


      }
    
    
   );

      const ctx = document.getElementById('myChart');

      teaching_load_ses = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: unique_lecturer  ,
              datasets: lineChartData.datasets,

          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Sustainable Energy Systems',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );


      var personcourses = {{personcourses|safe}}



      var personactivities_position = {{personactivities_position|safe}}
      var personactivities_project = {{personactivities_project|safe}}
      
      
      var lineChartData = {
        labels:personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Project  = personactivities_project.filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>personactivities_project['activity_type']).filter(onlyUnique)
      Position  = personactivities_position.filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>personactivities_position['activity_type']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person'])
          let unique_lecturer_i = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });

          console.log(unique_lecturer_i)


          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_position=[]
          var array_new_project=[]

          var array_new_Project=[]

          var array_new_total =[]
          var p=0


          for (k = 0; k <unique_lecturer_i.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            amount_position = 0
            amount_project = 0

            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_i[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_i[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_i[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_i[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  
                  if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }

                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252
 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }




                }
               }
               
              }
              if ((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_i[k]) || (personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_i[k])){
    
                if((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_i[k])){
    
                  poeng= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_i[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['arsverk'])))
                  amount= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_i[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['amount'])))
                  amount_position += 1750*poeng*amount/100
                  
                }
                if((personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_i[k])){
                      poeng= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_i[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['activity_antall_time'])))
                      amount= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_i[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['amount'])))
    
                      amount_project += poeng*amount

                    }

              }

              array_new_O1.push(amount_01) 
              array_new_O2.push(amount_02) 
              array_new_FE.push(amount_FE)
              array_new_FP.push(amount_FP)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_position.push(amount_position)
              array_new_project.push(amount_project)

          } 
   

              array_new_total.push(text.concat([array_new_O1]).concat(text2)) 
              array_new_total.push(text.concat([array_new_O2]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FE]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FP]).concat(text2)) 
              array_new_total.push(text.concat([array_new_MS]).concat(text2)) 
              array_new_total.push(text.concat([array_new_PH]).concat(text2)) 
              array_new_total.push(text.concat([array_new_position]).concat(text2)) 
              array_new_total.push(text.concat([array_new_project]).concat(text2)) 


          array_ses = array
          var color=[]
          color.push("#9ad0f5","#ffb0c1","#f7be85","#ffe6aa","#a4dfdf","#ccb2ff","#6a7e69","#825acf")
          console.log(color)


    array_new_total.forEach(function (a, i) {
          lineChartData.datasets.push({
              label:  unique_type[i],
              fillColor: 'rgba(216,140,154,0.2)',
              strokeColor: 'rgba(216,140,154,1)',
              pointColor: 'rgba(216,140,154,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(216,140,154,1)',
                  backgroundColor:color[i],
              data: JSON.parse(a)

           }
           )

          ;


      }
    
    
   );

      const ctx2 = document.getElementById('myChart2');

      teaching_load_ses = new Chart(ctx2, {
          type: 'bar',
          data: {
              labels: unique_lecturer_i  ,
              datasets: lineChartData.datasets,

          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Indecol',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );

      function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
      }

      var personcourses = {{personcourses|safe}}



      var personactivities_position = {{personactivities_position|safe}}
      var personactivities_project = {{personactivities_project|safe}}
      
      
      var lineChartData = {
        labels:personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Project  = personactivities_project.filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>personactivities_project['activity_type']).filter(onlyUnique)
      Position  = personactivities_position.filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>personactivities_position['activity_type']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person'])
          let unique_lecturer_t = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });

          console.log(unique_lecturer_t)


          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_position=[]
          var array_new_project=[]

          var array_new_Project=[]

          var array_new_total =[]
          var p=0


          for (k = 0; k <unique_lecturer_t.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            amount_position = 0
            amount_project = 0

            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  
                  if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }

                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252
 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }




                }
               }
               
              }
              if ((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_t[k]) || (personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_t[k])){
    
                if((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_t[k])){
    
                  poeng= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_t[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['arsverk'])))
                  amount= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_t[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['amount'])))
                  amount_position += 1750*poeng*amount/100
                  
                }
                if((personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_t[k])){
                      poeng= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_t[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['activity_antall_time'])))
                      amount= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_t[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['amount'])))
    
                      amount_project += poeng*amount

                    }

              }

              array_new_O1.push(amount_01) 
              array_new_O2.push(amount_02) 
              array_new_FE.push(amount_FE)
              array_new_FP.push(amount_FP)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_position.push(amount_position)
              array_new_project.push(amount_project)

          } 
   

              array_new_total.push(text.concat([array_new_O1]).concat(text2)) 
              array_new_total.push(text.concat([array_new_O2]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FE]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FP]).concat(text2)) 
              array_new_total.push(text.concat([array_new_MS]).concat(text2)) 
              array_new_total.push(text.concat([array_new_PH]).concat(text2)) 
              array_new_total.push(text.concat([array_new_position]).concat(text2)) 
              array_new_total.push(text.concat([array_new_project]).concat(text2)) 


          array_ses = array
          var color=[]
          color.push("#9ad0f5","#ffb0c1","#f7be85","#ffe6aa","#a4dfdf","#ccb2ff","#6a7e69","#825acf")


    array_new_total.forEach(function (a, i) {
          lineChartData.datasets.push({
              label:  unique_type[i],
              fillColor: 'rgba(216,140,154,0.2)',
              strokeColor: 'rgba(216,140,154,1)',
              pointColor: 'rgba(216,140,154,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(216,140,154,1)',
                  backgroundColor:color[i],
              data: JSON.parse(a)

           }
           )

          ;


      }
    
    
   );

      const ctx3 = document.getElementById('myChart3');

      teaching_load_ses = new Chart(ctx3, {
          type: 'bar',
          data: {
              labels: unique_lecturer_t  ,
              datasets: lineChartData.datasets,

          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Thermo fluid',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );


      var personcourses = {{personcourses|safe}}



      var personactivities_position = {{personactivities_position|safe}}
      var personactivities_project = {{personactivities_project|safe}}
      
      
      var lineChartData = {
        labels:personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Project  = personactivities_project.filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>personactivities_project['activity_type']).filter(onlyUnique)
      Position  = personactivities_position.filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>personactivities_position['activity_type']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person'])
          let unique_lecturer_p = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });

unique_lecturer_t = unique_lecturer_p
          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_position=[]
          var array_new_project=[]

          var array_new_Project=[]

          var array_new_total =[]
          var p=0


          for (k = 0; k <unique_lecturer_t.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            amount_position = 0
            amount_project = 0

            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  
                  if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }

                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252
 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).filter((personcourse) => (personcourse['course'] == Teaching[i])).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }




                }
               }
               
              }
              if ((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_t[k]) || (personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_t[k])){
    
                if((personactivities_position.map((personactivities_position)=>personactivities_position['person'])).includes(unique_lecturer_t[k])){
    
                  poeng= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_t[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['arsverk'])))
                  amount= (personactivities_position.filter((personactivities_position) => (personactivities_position['person'] == unique_lecturer_t[k] )).filter((personactivities_position) => (personactivities_position['activity_emne'] == 'L' )).map((personactivities_position)=>(personactivities_position['amount'])))
                  if (poeng.length>1){
                    for (a=0;a<poeng.length;a++){
                      amount_position += 1750*poeng[a]*amount[a]/100
                    }
                  }
                }
                if((personactivities_project.map((personactivities_project)=>personactivities_project['person'])).includes(unique_lecturer_t[k])){
                      poeng= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_t[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['activity_antall_time'])))
                      amount= (personactivities_project.filter((personactivities_project) => (personactivities_project['person'] == unique_lecturer_t[k] )).filter((personactivities_project) => (personactivities_project['activity_emne'] == 'P' )).map((personactivities_project)=>(personactivities_project['amount'])))
                      
                          amount_project += poeng*amount
                        
                      //amount_position += 1750*poeng*amount/100
                      
                      

                    }

              }


              array_new_O1.push(amount_01) 
              array_new_O2.push(amount_02) 
              array_new_FE.push(amount_FE)
              array_new_FP.push(amount_FP)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_position.push(amount_position)
              array_new_project.push(amount_project)

          } 
   

              array_new_total.push(text.concat([array_new_O1]).concat(text2)) 
              array_new_total.push(text.concat([array_new_O2]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FE]).concat(text2)) 
              array_new_total.push(text.concat([array_new_FP]).concat(text2)) 
              array_new_total.push(text.concat([array_new_MS]).concat(text2)) 
              array_new_total.push(text.concat([array_new_PH]).concat(text2)) 
              array_new_total.push(text.concat([array_new_position]).concat(text2)) 
              array_new_total.push(text.concat([array_new_project]).concat(text2)) 


          array_ses = array
          var color=[]
          color.push("#9ad0f5","#ffb0c1","#f7be85","#ffe6aa","#a4dfdf","#ccb2ff","#6a7e69","#825acf")


    array_new_total.forEach(function (a, i) {
          lineChartData.datasets.push({
              label:  unique_type[i],
              fillColor: 'rgba(216,140,154,0.2)',
              strokeColor: 'rgba(216,140,154,1)',
              pointColor: 'rgba(216,140,154,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(216,140,154,1)',
                  backgroundColor:color[i],
              data: JSON.parse(a)

           }
           )

          ;


      }
    
    
   );

      const ctx4 = document.getElementById('myChart4');

      teaching_load_ses = new Chart(ctx4, {
          type: 'bar',
          data: {
              labels: unique_lecturer_t  ,
              datasets: lineChartData.datasets,

          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Process and Power',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );

 </script>

</div> {%endblock%}