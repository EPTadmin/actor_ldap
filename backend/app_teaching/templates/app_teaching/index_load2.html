{% extends 'partials/base.html' %}

{%block content%}

<style>
  {
    box-sizing: border-box;
  }
  
  .column {
    float: right;
    width: 45%;
    padding: 30px;
  }
  
  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  </style>
{% comment %} <center>
  <div class="selectBox"><a >Choose a course type</a>
    <select id="typeselect">
      <option value = "{%for p in personcourses%} {{p.amount}},{%endfor%} ">All</option>
      <option value = "{%for p in personcourses%}{%if p.course_type == 'O1'%} {{p.amount}},{%endif%}{%endfor%} ">O1</option>
      <option value = "{%for p in personcourses%}{%if p.course_type == 'O2'%} {{p.amount}},{%endif%}{%endfor%} ">O2</option>
      <option value = "{%for p in personcourses%}{%if p.course_type == 'FE'%} {{p.amount}},{%endif%}{%endfor%} ">FE</option>
      <option value = "{%for p in personcourses%}{%if p.course_type == 'FP'%} {{p.amount}},{%endif%}{%endfor%} ">FP</option>
      <option value = "{%for p in personcourses%}{%if p.course.type == 'MS'%} {{p.amount}},{%endif%}{%endfor%} ">MS</option>
      <option value = "{%for p in personcourses%}{%if p.course.type == 'PH'%} {{p.amount}},{%endif%}{%endfor%} ">PH</option>

    </select>
    
  </div>
</center> {% endcomment %}
<div class="row">
  <div class="column" >
    <canvas id="myChart"></canvas>
  </div>
  <div class="column">
    <canvas id="myChart2"></canvas>

  </div>
</div>
<div class="row">
  <div class="column" >
    <canvas id="myChart3"></canvas>
  </div>
  <div class="column">
    <canvas id="myChart4"></canvas>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



    <script>


    


      function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
      }

      var personcourses = {{personcourses|safe}}
      {% comment %} console.log(personcourses) {% endcomment %}
      var lineChartData = {
        labels://personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
        personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person'])

          let unique_lecturer = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });

          type =personcourses.map((personcourse)=>personcourse['course_type'])
          let unique_type = type.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });
          console.log(unique_type)
          let text = "["
          let text2 = "]"

          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_total =[]
          var p=0

          for (t=0 ; t<unique_type.length;t++){console.log(unique_type[t])}
          for (k = 0; k <unique_lecturer.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_type'])=='PH'){
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer[k] )).map((personcourse)=>personcourse['course_sp'])
                    if  (poeng){
                      amount_PH += 250
                    }
                  }


                }
               }

              }
              console.log(unique_lecturer[k])
              array_new_O1.push(amount_01)
              array_new_O2.push(amount_02)
              array_new_FE.push(amount_FE)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_FP.push(amount_FP)
              array_new.push(amount_01,amount_02,amount_FE,amount_FP,amount_MS,amount_PH)
              //console.log('arraynew',array_new)




              array_new_total.push(text.concat([array_new]).concat(text2)) 
              array_new=[]
              array_new_O1=[]
              array_new_O2=[]
              array_new_FE=[]
              array_new_MS=[]
              array_new_PH=[]
              array_new_FP=[]

          }

console.log('array_new_total',array_new_total)
          array_ses = array


    array_new_total.forEach(function (a, i) {

          lineChartData.datasets.push({
              label:  unique_lecturer[i],
              fillColor: 'rgba(220,220,220,0.2)',
              strokeColor: 'rgba(220,220,220,1)',
              pointColor: 'rgba(220,220,220,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(220,220,220,1)',
              data: JSON.parse(a)

           }
           )

          ;

          //console.log(lineChartData.datasets[i].data,lineChartData.datasets[i].label)

      }
    
    
   );
   console.log('line',lineChartData.datasets[0].data)

      const ctx = document.getElementById('myChart');

      teaching_load_ses = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: unique_type  ,
              datasets: lineChartData.datasets
          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Sustainable Energy Systems',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );
      console.log('datasets',teaching_load_ses.data.datasets);
      console.log('datasets_0',teaching_load_ses.data.datasets[0].data);

      function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
      }

      var personcourses = {{personcourses|safe}}
      {% comment %} console.log(personcourses) {% endcomment %}
      var lineChartData = {
        labels://personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
        personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person'])

          let unique_lecturer_i = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });



          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_total =[]
          var p=0




          for (t=0 ; t<unique_type.length;t++){console.log(unique_type[t])}
          for (k = 0; k <unique_lecturer_i.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_i[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_i[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_i[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_i[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_type'])=='PH'){
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_i[k] )).map((personcourse)=>personcourse['course_sp'])
                    if  (poeng){
                      amount_PH += 250
                    }
                  }


                }
               }

              }
              console.log(unique_lecturer_i[k])
              array_new_O1.push(amount_01)
              array_new_O2.push(amount_02)
              array_new_FE.push(amount_FE)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_FP.push(amount_FP)
              array_new.push(amount_01,amount_02,amount_FE,amount_FP,amount_MS,amount_PH)
              //console.log('arraynew',array_new)




              array_new_total.push(text.concat([array_new]).concat(text2)) 
              array_new=[]
              array_new_O1=[]
              array_new_O2=[]
              array_new_FE=[]
              array_new_MS=[]
              array_new_PH=[]
              array_new_FP=[]

          }

console.log('array_new_total',array_new_total)
          array_ses = array


    array_new_total.forEach(function (a, i) {

          lineChartData.datasets.push({
              label:  unique_lecturer_i[i],
              fillColor: 'rgba(220,220,220,0.2)',
              strokeColor: 'rgba(220,220,220,1)',
              pointColor: 'rgba(220,220,220,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(220,220,220,1)',
              data: JSON.parse(a)

           }
           )

          ;

          //console.log(lineChartData.datasets[i].data,lineChartData.datasets[i].label)

      }
    
    
   );
   console.log('line',lineChartData.datasets[0].data)

      const ctx2 = document.getElementById('myChart2');

      teaching_load_indecol = new Chart(ctx2, {
          type: 'bar',
          data: {
              labels: unique_type  ,
              datasets: lineChartData.datasets
          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'indecol',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );
      console.log('datasets',teaching_load_ses.data.datasets);
      console.log('datasets_0',teaching_load_ses.data.datasets[0].data);

      function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
      }

      var personcourses = {{personcourses|safe}}
      {% comment %} console.log(personcourses) {% endcomment %}
      var lineChartData = {
        labels://personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
        personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person'])

          let unique_lecturer_t = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });



          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_total =[]
          var p=0




          for (t=0 ; t<unique_type.length;t++){console.log(unique_type[t])}
          for (k = 0; k <unique_lecturer_t.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_t[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_t[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_type'])=='PH'){
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_t[k] )).map((personcourse)=>personcourse['course_sp'])
                    if  (poeng){
                      amount_PH += 250
                    }
                  }


                }
               }

              }
              console.log(unique_lecturer_t[k])
              array_new_O1.push(amount_01)
              array_new_O2.push(amount_02)
              array_new_FE.push(amount_FE)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_FP.push(amount_FP)
              array_new.push(amount_01,amount_02,amount_FE,amount_FP,amount_MS,amount_PH)
              //console.log('arraynew',array_new)




              array_new_total.push(text.concat([array_new]).concat(text2)) 
              array_new=[]
              array_new_O1=[]
              array_new_O2=[]
              array_new_FE=[]
              array_new_MS=[]
              array_new_PH=[]
              array_new_FP=[]

          }

console.log('array_new_total',array_new_total)
          array_ses = array


    array_new_total.forEach(function (a, i) {

          lineChartData.datasets.push({
              label:  unique_lecturer_t[i],
              fillColor: 'rgba(220,220,220,0.2)',
              strokeColor: 'rgba(220,220,220,1)',
              pointColor: 'rgba(220,220,220,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(220,220,220,1)',
              data: JSON.parse(a)

           }
           )

          ;

          //console.log(lineChartData.datasets[i].data,lineChartData.datasets[i].label)

      }
    
    
   );
   console.log('line',lineChartData.datasets[0].data)

      const ctx3 = document.getElementById('myChart3');

      teaching_load_indecol = new Chart(ctx3, {
          type: 'bar',
          data: {
              labels: unique_type  ,
              datasets: lineChartData.datasets
          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'thermo-fluid',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );
      console.log('datasets',teaching_load_ses.data.datasets);
      console.log('datasets_0',teaching_load_ses.data.datasets[0].data);

      var personcourses = {{personcourses|safe}}
      {% comment %} console.log(personcourses) {% endcomment %}
      var lineChartData = {
        labels://personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['course_type']).filter(onlyUnique),
        personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person']).filter(onlyUnique),
          datasets: []
      },
      
      array = [{Teaching: personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['course']), Lecturer :  personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person']), Pourcent: personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['amount']),}][0];

      Teaching  = personcourses.map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O1  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O1' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_O2  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'O2' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FE  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FE' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_FP  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'FP' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_MS  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'MS' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)
      Teaching_PH  = personcourses.filter((personcourse) => (personcourse['course_type'] == 'PH' )).map((personcourse)=>personcourse['course']).filter(onlyUnique)



      Lecturer =personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person'])

          let unique_lecturer_p = Lecturer.filter(function(value, index, array) {
            return array.indexOf(value) === index;
          });



          var array_new=[]
          var array_new_O1=[]
          var array_new_O2=[]
          var array_new_FE=[]
          var array_new_FP=[]
          var array_new_MS=[]
          var array_new_PH=[]
          var array_new_total =[]
          var p=0




          for (t=0 ; t<unique_type.length;t++){console.log(unique_type[t])}
          for (k = 0; k <unique_lecturer_p.length; k++){
            amount_01 = 0
            amount_02 = 0
            amount_FE = 0
            amount_MS = 0
            amount_PH = 0
            amount_FP = 0
            for(i=0;i<Teaching.length;i++){

              for ( j = 0; j < array.Teaching.length; j++) { 
                if (((unique_lecturer_p[k] != array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_p[k] == array.Lecturer[j]) && (Teaching[i] != array.Teaching[j])) || ((unique_lecturer_p[k] != array.Lecturer[j]) && (Teaching[i] == array.Teaching[j]))) {
                  p=0
                  } 
                if ((unique_lecturer_p[k] == array.Lecturer[j]) && (Teaching[i] == array.Teaching[j])){

                  if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='O1'){
                    p=array.Pourcent[j] 
                    amount_01 +=  (array.Pourcent[j])/100*280 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='O2'){
                    p=array.Pourcent[j] 
                    amount_02 +=  (array.Pourcent[j])/100*252 
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='FE'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_FE +=  ((array.Pourcent[j]*poeng)/(100*3.75)*125)
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='FP'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    if (poeng==7.5){
                      amount_FP += (array.Pourcent[j])*30 
                    }else if (poeng==15){
                      amount_FP += (array.Pourcent[j])*40 
                    }else if (poeng==20){
                      amount_FP += (array.Pourcent[j])*50 

                    }
                  }else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='MS'){
                    p=array.Pourcent[j] 
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_sp'])
                    poeng = poeng.toString().replace(',','.') 
                    amount_MS +=  ((array.Pourcent[j]*poeng)/30*30)
                  }
                  else if (personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_type'])=='PH'){
                    poeng = personcourses.filter((personcourse) => (personcourse['course'] == Teaching[i] )).filter((personcourse) => (personcourse['person'] == unique_lecturer_p[k] )).map((personcourse)=>personcourse['course_sp'])
                    if  (poeng){
                      amount_PH += 250
                    }
                  }


                }
               }

              }
              console.log(unique_lecturer_p[k])
              array_new_O1.push(amount_01)
              array_new_O2.push(amount_02)
              array_new_FE.push(amount_FE)
              array_new_MS.push(amount_MS)
              array_new_PH.push(amount_PH)
              array_new_FP.push(amount_FP)
              array_new.push(amount_01,amount_02,amount_FE,amount_FP,amount_MS,amount_PH)
              //console.log('arraynew',array_new)




              array_new_total.push(text.concat([array_new]).concat(text2)) 
              array_new=[]
              array_new_O1=[]
              array_new_O2=[]
              array_new_FE=[]
              array_new_MS=[]
              array_new_PH=[]
              array_new_FP=[]

          }

console.log('array_new_total',array_new_total)
          array_ses = array


    array_new_total.forEach(function (a, i) {

          lineChartData.datasets.push({
              label:  unique_lecturer_p[i],
              fillColor: 'rgba(220,220,220,0.2)',
              strokeColor: 'rgba(220,220,220,1)',
              pointColor: 'rgba(220,220,220,1)',
              pointStrokeColor: '#fff',
              pointHighlightFill: '#fff',
              pointHighlightStroke:
                  'rgba(220,220,220,1)',
              data: JSON.parse(a)

           }
           )

          ;

          //console.log(lineChartData.datasets[i].data,lineChartData.datasets[i].label)

      }
    
    
   );
   console.log('line',lineChartData.datasets[0].data)

      const ctx4 = document.getElementById('myChart4');

      teaching_load_indecol = new Chart(ctx4, {
          type: 'bar',
          data: {
              labels: unique_type  ,
              datasets: lineChartData.datasets
          },
          
          options: {
            plugins: {
              title: {
                  display: true,
                  text: 'Process and Power',
                  padding: {
                      top: 10,
                      bottom: 30
                  }
              }
            },
            
              skipNull:false,
              indexAxis :'x',
              scales: {
                x:{
                  stacked: true,
                },
                  y: {
                    stacked: true,
                      
                  }
              }

          }
          
      }

      );
      console.log('datasets',teaching_load_ses.data.datasets);
      console.log('datasets_0',teaching_load_ses.data.datasets[0].data);
      
      const typeselect = document.getElementById('typeselect');
      typeselect.addEventListener('change',trackers);   
      
      function trackers(){
        var type = (typeselect.options[typeselect.selectedIndex].text)
        console.log('datasets',teaching_load_ses.data.datasets)

        if (type !== 'All' ){
          teaching_load_ses.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).filter((personcourse) => (personcourse['course_type'] == type)).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_indecol.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).filter((personcourse) => (personcourse['course_type'] == type)).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_thermo.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).filter((personcourse) => (personcourse['course_type'] == type)).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_process.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).filter((personcourse) => (personcourse['course_type'] == type)).map((personcourse)=>personcourse['person']).filter(onlyUnique)
        }
        else if (type == 'All'){
          teaching_load_ses.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 's' )).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_indecol.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 'i' )).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_thermo.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 't' )).map((personcourse)=>personcourse['person']).filter(onlyUnique)
          teaching_load_process.data.labels =  personcourses.filter((personcourse) => (personcourse['person_group'] == 'p' )).map((personcourse)=>personcourse['person']).filter(onlyUnique)
        }


        teaching_load_ses.update();
        teaching_load_indecol.update();
        teaching_load_thermo.update();
        teaching_load_process.update();

      }
 </script>

</div> {%endblock%}